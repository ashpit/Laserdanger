<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Recent 1D Lidar Profiles</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #fff; }
    #plotDiv { width: 90vw; height: 600px; }
  </style>
</head>
<body>
  <h2>Recent 1D Lidar Profiles</h2>
  <div id="plotDiv"></div>

  <script>
    fetch('lidar_plot_data.json')
      .then(response => response.json())
      .then(data => {
        const profiles = data.profiles;
        const stackX = data.stackx;
        const stackZ = data.stackz;

        // Create line traces for each profile
        const profileTraces = profiles.map((p, i) => ({
          x: p.x,
          y: p.z,
          mode: 'lines',
          line: {
            color: `rgb(${p.color.map(c => Math.round(c * 255)).join(',')})`,
            width:  4 * (i / profiles.length)  // thicker lines for later profiles
          },
          name: p.dates
        }));

        // Create scatter trace for stack points
        const stackTrace = {
          x: stackX,
          y: stackZ,
          mode: 'markers',
          marker: {
            symbol: 'triangle-up',
            size: 10,
            color: 'red'
          },
          name: 'Stack Points'
        };

        // Datum lines: MHHW, MHW, MSL
        const datums = [
          { name: 'MHHW', y: 1.566 },
          { name: 'MHW', y: 1.344 },
          { name: 'MSL', y: 0.774 }
        ];

        const datumTraces = datums.map(datum => ({
          x: [0, 50],
          y: [datum.y, datum.y],
          mode: 'lines',
          line: {
            dash: 'dash',
            color: 'black'
          },
          name: datum.name,
          showlegend: true
        }));

        // Combine all traces
        const traces = [...profileTraces, stackTrace, ...datumTraces];

        const layout = {
          title: 'Recent 1D Lidar Profiles',
          xaxis: {
            title: 'Cross-shore Distance (m)',
            range: [0, 50]
          },
          yaxis: {
            title: 'Elevation (NAVD88)',
            range: [0.5, 3.5]
          },
          font: { size: 14 },
          legend: { orientation: 'h', y: -0.2 }
        };

        Plotly.newPlot('plotDiv', traces, layout);
      })
      .catch(err => {
        console.error('Error loading or parsing JSON:', err);
        document.getElementById('plotDiv').innerHTML = '<p style="color:red;">Error loading data. Check console for details.</p>';
      });
  </script>
</body>
</html>

